$(function(){


$('input[name="phone"]').mask("+7 (999) 999-99-99");

var page_url = window.location.href,
    arr = page_url.split('corp', 1),
    hotelName;

console.log(arr[0] + ' ' + hotelName);


    $('.t-submit').on('click', function(e){

        e.preventDefault();

        var $this = $(this),
            thisForm = $this.parents('form'),
            thisFormParent = thisForm.parent('div'),
            thisFormParentHeight = thisFormParent.height(),
            name = thisForm.find('input[name="name"]'),
            phone = thisForm.find('input[name="phone"]'),
            email = thisForm.find('input[name="email"]'),
            hidden = thisForm.find('input[name="hidden"]'),
            goal = $this.attr('data-reach-goal'),
            corp = 1,
            nameVal = name.val(),
            phoneVal = phone.val(),
            emailVal = email.val(),
            hiddenVal = hidden.val(),
            formData,
            hotelName = "Системайс";

            if (!emailVal) emailVal = 'нет';

            if (phoneVal != '') {

            // console.log(formData + " " + yaID);
                jsonData = {};
                jsonData.corp = 1,
                jsonData.name = nameVal,
                jsonData.phone = phoneVal,
                jsonData.email = emailVal,
                jsonData.hotel = hotelName;
                jsonData.text = 'Имя / Название компании: ' + nameVal + '\n' + 'Телефон: ' + phoneVal + '\n' + 'Email: ' + emailVal + '\n' + 'Подарок: ' + hiddenVal + '\n' + 'Сайт: ' + arr[0] + '\n';


				$.ajax({
					type: "POST", //Метод отправки
					url: "https://sysevent.ru/bron.php", //путь до php фаила отправителя
					data: jsonData,
					dataType: 'json',
                    beforeSend: function(){

                        thisFormParent.height(thisFormParentHeight);
                        $this.attr('disabled', true);
                    },
					success: function (data) {
						 thisForm.fadeOut();

                            setTimeout(function(){

                                thisFormParent.find('.form-success').fadeIn();
                            }, 500);

                            yaID.reachGoal(goal);
					},
					error : function () {
						thisForm.fadeOut();

                        setTimeout(function(){

                            thisFormParent.find('.form-error').fadeIn();
                        }, 500);
					}
				});
			

            }

            else {

                phoneVal =='' ? phone.css({'border-color': 'red'}) : '';
            }
    });

    $('input[name="phone"]').on('keyup', function(){

        $(this).css({'border-color': 'transparent'});
    });

});

