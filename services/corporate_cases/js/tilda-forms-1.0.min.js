$(function(){

$('input[name="phone"]').inputmask({"mask": "+7 (999) 999-99-99"});

    $('.t-submit').on('click', function(e){

        e.preventDefault();

        var $this = $(this),
            thisForm = $this.parents('form'),
            thisFormParent = $(".form-wrapper"),
            thisFormHeight = thisForm.height(),
            name = thisForm.find('input[name="name"]'),
            phone = thisForm.find('input[name="phone"]'),
            comment = thisForm.find('textarea[name="comment"]'),
            goal = $this.attr('data-reach-goal'),
            nameVal = name.val(),
            phoneVal = phone.val(),
            commentVal = comment.val();

            if (phoneVal != '') {

                jsonData = {};
                jsonData.corp = 1,
                jsonData.name = nameVal,
                jsonData.phone = phoneVal,
                jsonData.knight_id = 11173,
                jsonData.hotel = "Корпоративные кейсы";
                jsonData.text = 'Телефон: ' + phoneVal + '\n' + 'Имя: ' + nameVal + '\n' + 'Комментарий: ' + commentVal + '\n' + 'Сайт: http://systemice.ru/corporate_cases/';

                $.ajax({
                    type: "POST",
                    url: "https://sysevent.ru/bron.php",
                    data: jsonData,
                    dataType: 'json',
                    beforeSend: function(){

                        thisFormParent.height(thisFormHeight);
                        $this.attr('disabled', true);
                        $this.text('Отправка...');
                        $this.css({'background': '#BFA220'});
                    },
                    success: function (data) {
                         thisForm.fadeOut();

                            setTimeout(function(){

                                thisFormParent.find('.form-success').fadeIn();
                            }, 400);

                            yaID.reachGoal(goal);
                    },
                    error : function () {
                        thisForm.fadeOut();

                        setTimeout(function(){

                            thisFormParent.find('.form-error').fadeIn();
                        }, 400);
                    }
                });
            }

            else {

                phoneVal =='' ? phone.css({'border-color': 'red'}) : '';
            }
    });

    $('input[name="phone"]').on('keyup', function(){

        $(this).css({'border-color': 'transparent'});
    })
})